<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEMONSTRATIVO MENSAL MESTRE PACIFICO - DIN√ÇMICO V5</title>
    <style>
        /* CONFIGURA√á√ÉO PARA ORIENTA√á√ÉO PAISAGEM (IMPRESS√ÉO) */
        @page {
            size: A4 landscape;
            margin: 10mm;
        }

        /* Estilos Globais e do Corpo do Documento */
        body {
            font-family: 'Times New Roman', serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0; 
            font-size: 10pt;
            color: #000;
        }

        /* ---------------------------------------------------- */
        /* SIDEBAR (PAINEL DE EDI√á√ÉO) - FIXA */
        /* ---------------------------------------------------- */
        .sidebar {
            background-color: #f7f7f7;
            border-right: 1px solid #ddd;
            padding: 15mm 15px; 
            font-size: 9pt;
            overflow-y: auto;
            position: fixed; 
            top: 0; 
            left: 0; 
            bottom: 0; 
            width: 320px; 
            z-index: 1000; 
            box-sizing: border-box;
        }

        .sidebar h4 {
            color: #004a99;
            border-bottom: 2px solid #004a99;
            padding-bottom: 5px;
            margin-top: 20px;
            font-size: 11pt;
        }
        .sidebar h5 {
            margin-top: 15px;
            margin-bottom: 5px;
            font-size: 10pt;
        }

        .sidebar label {
            display: block;
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 3px;
            font-size: 9pt;
        }

        .sidebar input[type="text"],
        .sidebar input[type="number"],
        .sidebar input[type="date"],
        .sidebar select {
            width: 95%;
            padding: 3px;
            border: 1px solid #aaa;
            border-radius: 3px;
            box-sizing: border-box;
            font-size: 8pt;
            margin-bottom: 5px;
        }
        .sidebar .date-pair {
            display: flex;
            justify-content: space-between;
        }
        .sidebar .date-pair input {
            width: 48%;
        }

        .sidebar button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 9pt;
            margin-top: 10px;
            cursor: pointer;
            border-radius: 4px;
        }
        .sidebar button:hover {
            background-color: #45a049;
        }
        /* Bot√µes de adicionar linha mantidos na sidebar */
        .sidebar .add-row-btn {
             background-color: #004a99;
             margin-bottom: 5px;
        }
        .sidebar .add-row-btn:hover {
             background-color: #003066;
        }
        

        /* ---------------------------------------------------- */
        /* CONTE√öDO PRINCIPAL - AGORA FLUTUANTE */
        /* ---------------------------------------------------- */
        .main-content-area {
            margin-left: 320px; 
            padding: 0 30px; 
            min-height: 100vh;
        }

        .document-container {
            width: 297mm;
            min-height: 210mm;
            margin: 30px auto; 
            padding: 0mm 15mm;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            box-sizing: border-box;
        }

        /* Impede que a sidebar apare√ßa na impress√£o */
        @media print {
            .sidebar {
                display: none;
            }
            .main-content-area {
                margin-left: 0;
            }
            .document-container {
                margin: 0;
                box-shadow: none;
            }
        }
        
        /* ---------------------------------------------------- */
        /* ESTILOS DE TABELA DIN√ÇMICA */
        /* ---------------------------------------------------- */
        .data-table table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            margin-bottom: 15px;
        }
        .data-table th, .data-table td {
            border: 1px solid #000;
            padding: 2px;
            text-align: center;
            font-size: 7.5pt;
            word-break: break-word; 
            white-space: normal !important;
            vertical-align: middle;
        }
        .data-table th {
            font-weight: bold;
            background-color: #e0e0e0;
        }
        
        /* Adicionar estilos para o Timbre (Cabe√ßalho Institucional) */
        .header-institutional {
            text-align: center;
            margin-bottom: 20px; /* Espa√ßo entre o timbre e o t√≠tulo */
            padding-top: 10px;
        }

        #timbre-imagem {
            max-width: 100%;
            display: block; /* Garante o alinhamento central */
        }
        /* Estilos para INPUTs e SELECTs dentro das C√âLULAS */
        .data-table input[type="text"],
        .data-table input[type="number"],
        .data-table input[type="date"],
        .data-table select {
            width: 90%;
            padding: 0;
            margin: 0;
            border: none;
            text-align: center;
            font-size: 7.5pt;
            background: transparent;
        }

        /* Tabela 2 - Estilo de Texto/Lista para Card√°pio e Observa√ß√µes */
        #table-cardapio-body td:nth-child(6) select {
            width: 98%;
            text-align: left;
        }
        #table-cardapio-body td:nth-child(8) input {
             width: 98%;
             text-align: left;
        }
        
        /* NOVO: Estilo para centralizar n√∫mero e unidade na mesma linha (Tabela 3) */
        #tabela-estoque .quantity-cell {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }
        #tabela-estoque .quantity-cell input {
            width: 70%; 
            text-align: right;
            padding-right: 2px;
        }
        #tabela-estoque .quantity-cell .unit {
            width: 30%;
            text-align: left;
            padding-left: 2px;
        }
        /* Ajuste espec√≠fico para a descri√ß√£o do g√™nero */
        #tabela-estoque td:nth-child(2) select {
            width: 98%;
            text-align: left;
        }


        /* Estilo para o bot√£o de remo√ß√£o */
        .remove-row-btn {
            background: none;
            border: none;
            color: red;
            cursor: pointer;
            font-size: 10pt;
            padding: 0 2px;
            line-height: 1;
        }
        .remove-row-btn:hover {
            color: darkred;
        }

        /* ---------------------------------------------------- */
        /* ESTILOS DO DOCUMENTO (MANTIDOS/AJUSTADOS) */
        /* ---------------------------------------------------- */
        
        #tabela-detalhes td {
            height: 30px; 
            vertical-align: middle;
        }
        #tabela-estoque th, #tabela-estoque td {
            text-align: left;
        }
        #tabela-estoque td:nth-child(1), #tabela-estoque td:nth-child(3), #tabela-estoque td:nth-child(4), #tabela-estoque td:nth-child(5) {
            text-align: center;
        }
        .footer-document {
            margin-top: 50px;
            padding-top: 10px;
        }
        .signatures {
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin-bottom: 20px;
        }
        .signatures div {
            width: 30%;
        }
        .signatures hr {
            border: 0;
            border-top: 1px solid #000;
            margin-bottom: 5px;
        }
        #tabela-detalhes span {
            display: block;
            width: 100%;
        }

        /* Adicionar estilos para o Rodap√© Institucional */
        .footer-semed {
            text-align: center;
            margin-top: 15px; /* Espa√ßamento entre as assinaturas e o rodap√© */
        }

        #rodape-imagem {
            width: 100%; /* Garante que o rodap√© ocupe a largura total do container */
            display: block;
        }
        
        /* 1. Permite que as linhas da tabela cres√ßam conforme o conte√∫do */
        #table-cardapio-body tr,
        #table-estoque-body tr {
            height: auto !important;
        }

        /* 2. Estilo para as c√©lulas clic√°veis */
        #table-cardapio-body td:nth-child(3), /* NOVA: Freq Creche */
        #table-cardapio-body td:nth-child(4), /* NOVA: Freq Ed Inf/Fund */
        #table-cardapio-body td:nth-child(5), /* NOVA: Freq EJA */
        #table-cardapio-body td:nth-child(6), /* Card√°pio */
        #table-cardapio-body td:nth-child(8), /* Justificativa */
        #table-estoque-body td:nth-child(6) { /* Relat√≥rio */
            vertical-align: top;
            padding: 0; 
            cursor: pointer; 
            text-align: center; /* CENTRALIZA√á√ÉO: Centraliza as colunas de frequ√™ncia */
        }

        /* 3. Estilo para a tag <p> (Modo de visualiza√ß√£o) */
        #table-cardapio-body td p,
        #table-estoque-body td p {
            margin: 0;
            min-height: 10px; /* Altura m√≠nima para n√£o colapsar a linha */
            padding: 4px 5px;
            border: 1px solid transparent; 
            transition: background-color 0.2s;
            text-align: left;
            white-space: pre-wrap; /* Permite quebras de linha e texto envolvente */
        }

        /* Efeito visual ao passar o mouse */
        #table-cardapio-body td:hover p,
        #table-estoque-body td:hover p {
            background-color: #f0f0f0;
        }

        /* 4. Estilos para os campos din√¢micos (Modo de edi√ß√£o) */
        #table-cardapio-body select.edit-field,
        #table-cardapio-body textarea.edit-field,
        #table-estoque-body textarea.edit-field {
            width: 100%;
            height: auto; /* Altura controlada pelo JS */
            box-sizing: border-box;
            padding: 2px;
            margin: 0;
            border: 1px solid #000;
            resize: vertical; /* Permite que o usu√°rio redimensione a altura */
            min-height: 40px; 
            overflow-y: hidden;
            line-height: 1.2;
        }

        /* Garante que o select ocupe a altura m√≠nima para ser vis√≠vel */
        #table-cardapio-body select.edit-field {
            min-height: 30px;
        }
        
        /* 5. Centraliza√ß√£o para conte√∫do vazio (NOVA REGRA) */
        #table-cardapio-body td .center-if-empty,
        #table-estoque-body td .center-if-empty {
            text-align: center !important;
        }
        /* 3.1 Estilo espec√≠fico para as tags <p> de Frequ√™ncia (NOVO) */
        #table-cardapio-body td:nth-child(3) p, 
        #table-cardapio-body td:nth-child(4) p, 
        #table-cardapio-body td:nth-child(5) p {
            text-align: center; 
            white-space: nowrap; /* N√£o quebra linha em n√∫meros curtos/X */
        }

        /* 4.1 Estilo espec√≠fico para o input de Frequ√™ncia (NOVO) */
        #table-cardapio-body input.attendance-edit-field {
            width: 100%;
            height: 30px; 
            box-sizing: border-box;
            padding: 2px;
            margin: 0;
            border: 1px solid #000;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <h4>1. Detalhes da Escola (Tabela 1)</h4>

        <label for="nome_escola_input">NOME DA ESCOLA</label>
        <select id="nome_escola_input">
            <option value="Escola Mestre Pac√≠fico" selected>Escola Mestre Pac√≠fico</option>
            <option value="Escola Jo√£o Fernandes de Oliveira">Escola Jo√£o Fernandes de Oliveira</option>
            <option value="Escola Marilda Carvalho">Escola Marilda Carvalho</option>
            <option value="Escola Raimundo Pereira">Escola Raimundo Pereira</option>
            <option value="Escola Mestre Pac√≠fico - CEMEP">Escola Mestre Pac√≠fico - CEMEP</option>
            <option value="Escola Mestre Pac√≠fico - INTEGRAL">Escola Mestre Pac√≠fico - INTEGRAL</option>
        </select>

        <label for="endereco_escola_input">ENDERE√áO</label>
        <select id="endereco_escola_input">
            <option value="Comunidade Igarap√© A√ßu" selected>Comunidade Igarap√© A√ßu</option>
            <option value="Comunidade Ipixuna">Comunidade Ipixuna</option>
            <option value="Comunidade Arum√£">Comunidade Arum√£</option>
            <option value="Comunidade Andirobal">Comunidade Andirobal</option>
        </select>
        
        <label for="meio_escola_input">√ÅREA</label>
        <select id="meio_escola_input">
            <option value="Terra Firme" selected>Terra Firme</option>
            <option value="Terra Varzea">V√°rzea</option>
        </select>

        <label for="municipio_escola_input">MUNIC√çPIO</label>
        <select id="municipio_escola_input">
            <option value="√ìbidos" selected>√ìbidos</option>
        </select>

        <label for="num_alunos_input">N¬∞ DE ALUNOS MATRICULADOS</label>
        <input type="number" id="num_alunos_input" value="330">
        
        <label for="tipo_ensino_input">TIPO DE ENSINO</label>
        <select id="tipo_ensino_input">
            <option value="Ed. Inf. E Ens. Fund." selected>Ed. Inf. E Ens. Fund.</option>
            <option value="Ed. Infantil">Ed. Infantil</option>
            <option value="Ens. Fundamental">Ens. Fundamental</option>
        </select>
        <h5>Sele√ß√£o de Card√°pio</h5>
        <div style="margin-bottom: 10px; display: flex; justify-content: space-around;">
            <div>
                <input type="radio" id="cardapio_regular" name="tipo_cardapio" value="regular" checked>
                <label for="cardapio_regular" style="display: inline; width: auto; margin-left: 5px;">Regular</label>
            </div>
            <div>
                <input type="radio" id="cardapio_integral" name="tipo_cardapio" value="integral">
                <label for="cardapio_integral" style="display: inline; width: auto; margin-left: 5px;">Integral</label>
            </div>
        </div>
        
        <label for="periodo_input">PER√çODO (In√≠cio e Fim) - Gera as datas da Tabela 2</label>
        <div class="date-pair">
            <input type="date" id="data-inicial" value="2025-09-01" onchange="generateTable2Rows()">
            <input type="date" id="data-final" value="2025-09-30" onchange="generateTable2Rows()">
        </div>
        <button id="gerar-cardapio" onclick="generateTable2Rows()">Gerar Datas e Card√°pios (Tabela 2)</button>

        
        <hr style="margin-top: 20px;">
        
        <h5>Data do Documento</h5>
        <input type="date" id="document_date_input" class="data-input">

        <hr style="margin-top: 20px;">

        <h5>Gerenciamento de Linhas</h5>
        <button class="add-row-btn" onclick="addRowTable2()">+ Adicionar Linha (Tabela 2)</button>
        <button class="add-row-btn" onclick="addRowTable3()">+ Adicionar Linha (Tabela 3)</button>

    </div>
    <div class="main-content-area">
        <div class="document-container">

            <div class="header-institutional">
                <img id="timbre-imagem" src="timbre.png" alt="Logotipo da Institui√ß√£o">
            </div>

            <h2 style="text-align: center; font-size: 11pt; margin: 10px 0; text-decoration: underline;">DEMONSTRATIVO MENSAL DA DISTRIBUI√á√ÉO DE REFEI√á√ïES E CONSUMO DE G√äNEROS ALIMENT√çCIOS NA ESCOLA</h2>

            <div class="data-table">
                <table id="tabela-detalhes">
                    <thead>
                        <tr>
                            <th style="width: 15%;">NOME DA ESCOLA</th>
                            <th style="width: 18%;">ENDERE√áO</th>
                            <th style="width: 8%;">MEIO</th>
                            <th style="width: 10%;">MUNIC√çPIO</th>
                            <th style="width: 13%;">DEPEND√äNCIA ADMINISTRATIVA</th>
                            <th style="width: 10%;">N¬∞ DE ALUNOS MATRICULADOS</th>
                            <th style="width: 13%;">TIPO DE ENSINO</th>
                            <th style="width: 13%;">PER√çODO</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span id="nome_escola_display">Escola Mestre Pac√≠fico</span></td>
                            <td><span id="endereco_escola_display">Comunidade Igarap√© A√ßu</span></td>
                            <td><span id="meio_escola_display">Terra Firme</span></td>
                            <td><span id="municipio_escola_display">√ìbidos</span></td>
                            <td>Municipal</td>
                            <td><span id="num_alunos_display">330</span></td>
                            <td><span id="tipo_ensino_display">Ed. Inf. E Ens. Fund.</span></td>
                            <td><span id="periodo_display">01/09/2025<br>30/09/2025</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="data-table" id="table-cardapio">
                <table class="table-cardapio">
                    <thead>
                        <tr>
                            <th rowspan="2" style="width: 3%;">QUANT. DIAS</th>
                            <th rowspan="2" style="width: 9%;">FREQ. DO DIA/<br>DATA</th>
                            <th colspan="3">ALUNOS ATENDIDOS</th>
                            <th rowspan="2" style="width: 35%;">CARD√ÅPIO</th>
                            <th rowspan="2" style="width: 2%;"></th>
                            <th rowspan="2" style="width: 34%;">JUSTIFICATIVA / OBSERVA√á√ÉO</th>
                        </tr>
                        <tr>
                            <th style="width: 8%;">CRECHE</th>
                            <th style="width: 11%;">ED. INF. E FUNDAMENTAL</th>
                            <th style="width: 8%;">EJA</th>
                        </tr>
                    </thead>
                    <tbody id="table-cardapio-body">
                        </tbody>
                </table>
            </div>
        
            <div class="data-table" id="table-mapa">
                <h3 style="text-align: center; font-size: 10pt; font-weight: bold; margin-bottom: 5px;">CONTROLE DE G√äNEROS ALIMENT√çCIOS</h3>
                <table id="tabela-estoque">
                    <thead>
                        <tr>
                            <th colspan="2" style="width: 20%;">G√äNEROS RECEBIDOS DO PROGRAMA</th>
                            <th rowspan="2" style="width: 6%;">QUANT. DE ALIM. CONS.</th>
                            <th rowspan="2" style="width: 10%;">QUANT. DE ALIM. J√Å EM ESTOQUE (antes da entrega)</th>
                            <th rowspan="2" style="width: 7%;">SALDO ATUAL</th>
                            <th rowspan="2" style="width: 40%;">RELAT√ìRIO</th>
                            <th rowspan="2" style="width: 2%;"></th></tr>
                        <tr>
                            <th style="width: 7%;">QUANT.</th>
                            <th style="width: 17%;">DISCRIMINA√á√ÉO</th>
                        </tr>
                    </thead>
                    <tbody id="table-estoque-body">
                        </tbody>
                </table>
                <p style="text-align: right; margin-bottom: 30px;">√ìbidos (PA), <span id="document_date_display">22 de agosto de 2025</span>.</p>
            </div>

            <div class="footer-document">
                <div class="signatures">
                    <div>
                        <hr>
                        <p>Diretor(a) da Escola</p>
                    </div>
                    <div>
                        <hr>
                        <p>Respons√°vel pelo Dep√≥sito</p>
                    </div>
                    <div>
                        <hr>
                        <p>Respons√°vel pelo preenchimento</p>
                    </div>
                </div>

                <div class="footer-semed">
                   <img id="rodape-imagem" src="rodape.png" alt="Rodap√© Institucional">
                </div>
            </div>
            </div>

        </div>
    </div>

    <script>
        // Fun√ß√£o que atualiza os dados da Tabela 1 com base no sidebar
        function atualizarTabela1() {
            // Obter valores dos inputs/selects
            const nome = document.getElementById("nome_escola_input").value;
            const endereco = document.getElementById("endereco_escola_input").value;
            const meio = document.getElementById("meio_escola_input").value;
            const municipio = document.getElementById("municipio_escola_input").value;
            const numAlunos = document.getElementById("num_alunos_input").value;
            const tipoEnsino = document.getElementById("tipo_ensino_input").value;

            // Atualizar spans na tabela
            document.getElementById("nome_escola_display").textContent = nome;
            document.getElementById("endereco_escola_display").textContent = endereco;
            document.getElementById("meio_escola_display").textContent = meio;
            document.getElementById("municipio_escola_display").textContent = municipio;
            document.getElementById("num_alunos_display").textContent = numAlunos;
            document.getElementById("tipo_ensino_display").textContent = tipoEnsino;

            // Atualizar per√≠odo
            const inicio = document.getElementById("data-inicial").value;
            const fim = document.getElementById("data-final").value;

            if (inicio && fim) {
                // Criar datas sem ajustar fuso (corrigindo o erro de -1 dia)
                const dataInicio = new Date(inicio + "T00:00:00");
                const dataFim = new Date(fim + "T00:00:00");

                // Valida√ß√£o: in√≠cio n√£o pode ser depois do fim
                if (dataInicio > dataFim) {
                    alert("‚ö†Ô∏è A data inicial n√£o pode ser maior que a data final!");
                    document.getElementById("data-inicial").value = "";
                    document.getElementById("periodo_display").innerHTML = "";
                    return;
                }

                // Corrigir diferen√ßa de fuso (adiciona 1 dia ao hor√°rio UTC)
                dataInicio.setMinutes(dataInicio.getMinutes() + dataInicio.getTimezoneOffset());
                dataFim.setMinutes(dataFim.getMinutes() + dataFim.getTimezoneOffset());

                // Formatar datas no formato dd/mm/yyyy
                const formatoBR = (data) =>
                    `${String(data.getDate()).padStart(2, "0")}/${String(data.getMonth() + 1).padStart(2, "0")}/${data.getFullYear()}`;

                document.getElementById("periodo_display").innerHTML =
                    `${formatoBR(dataInicio)}<br>${formatoBR(dataFim)}`;
            }
        }

        // Adicionar eventos de escuta para todos os campos relevantes
        document.getElementById("nome_escola_input").addEventListener("change", atualizarTabela1);
        document.getElementById("endereco_escola_input").addEventListener("change", atualizarTabela1);
        document.getElementById("meio_escola_input").addEventListener("change", atualizarTabela1);
        document.getElementById("municipio_escola_input").addEventListener("change", atualizarTabela1);
        document.getElementById("num_alunos_input").addEventListener("input", atualizarTabela1);
        document.getElementById("tipo_ensino_input").addEventListener("change", atualizarTabela1);
        document.getElementById("data-inicial").addEventListener("change", atualizarTabela1);
        document.getElementById("data-final").addEventListener("change", atualizarTabela1);







        //[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[TABELA 2]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]
        //       PERMITE AO USU√ÅRIO MODIFICAR AS DATAS DA COLUNA 2
        
        //[[[[[[[[[[[[[[[[[[[[[PREENCHE A TABELA CAD√ÅPIO[[[[[[[]]]]]]]]]]]]]]]]]]]]]]]]]]]]
        document.addEventListener("DOMContentLoaded", function () {
            const tbody = document.getElementById("table-cardapio-body");

            // üß± Fun√ß√£o para formatar data no padr√£o BR
            function formatarDataBR(data) {
                const d = new Date(data);
                const dia = String(d.getDate()).padStart(2, "0");
                const mes = String(d.getMonth() + 1).padStart(2, "0");
                const ano = d.getFullYear();
                return `${dia}/${mes}/${ano}`;
            }

            // üß© Fun√ß√£o para criar uma linha na tabela
            function criarLinha(numeroDia, data) {
                const tr = document.createElement("tr");

                tr.innerHTML = `
                    <td style="text-align:center;">${numeroDia}</td>
                    <td style="text-align:center;">${formatarDataBR(data)}</td>
                    <td style="text-align:center;" class="aluno-creche">X</td>
                    <td style="text-align:center;" class="aluno-fundamental">X</td>
                    <td style="text-align:center;" class="aluno-eja">X</td>
                    <td>
                        <select class="select-cardapio" style="width:100%;">
                            <option value="">Selecione o card√°pio</option>
                            <option value="Arroz, Feij√£o e Frango">Arroz, Feij√£o e Frango</option>
                            <option value="Macarronada com Carne Mo√≠da">Macarronada com Carne Mo√≠da</option>
                            <option value="Sopa de Legumes">Sopa de Legumes</option>
                            <option value="Farinha com Peixe Frito">Farinha com Peixe Frito</option>
                            <option value="Outra op√ß√£o">Outra op√ß√£o</option>
                        </select>
                    </td>
                    <td style="text-align:center;">
                        <button class="remove-row" title="Remover linha" style="background:none; border:none; cursor:pointer; font-size:18px;">
                            üóëÔ∏è
                        </button>
                    </td>
                    <td>
                        <input type="text" placeholder="Justificativa ou observa√ß√£o..." style="width:100%;">
                    </td>
                `;

                // üóëÔ∏è A√ß√£o de remover linha
                tr.querySelector(".remove-row").addEventListener("click", () => tr.remove());

                tbody.appendChild(tr);
            }

            // ‚öôÔ∏è Fun√ß√£o para gerar todas as linhas da tabela com base no per√≠odo
            function gerarTabelaCardapio(dataInicial, dataFinal) {
                tbody.innerHTML = ""; // limpa tabela antes de gerar novas linhas

                // ‚ö†Ô∏è Corrigido para ignorar fuso hor√°rio
                const inicio = new Date(dataInicial + "T00:00:00");
                const fim = new Date(dataFinal + "T00:00:00");

                if (isNaN(inicio) || isNaN(fim)) {
                    alert("Selecione um per√≠odo v√°lido!");
                    return;
                }

                let diaAtual = new Date(inicio);
                let contador = 1;

                // ‚úÖ Garante que o √∫ltimo dia (data final) tamb√©m seja inclu√≠do
                while (diaAtual <= fim) {
                    criarLinha(contador, new Date(diaAtual));
                    diaAtual.setDate(diaAtual.getDate() + 1);
                    contador++;
                }
            }

            // üîò Evento do bot√£o "Gerar Datas e Card√°pios"
            const gerarBtn = document.getElementById("gerar-cardapio"); // ID do bot√£o no sidebar

            if (gerarBtn) {
                gerarBtn.addEventListener("click", function () {
                    const dataInicial = document.getElementById("data-inicial").value;
                    const dataFinal = document.getElementById("data-final").value;

                    gerarTabelaCardapio(dataInicial, dataFinal);
                });
            }
        });








        document.addEventListener("DOMContentLoaded", function () {
            const tbody = document.getElementById("table-cardapio-body");

            function formatarDataBR(data) {
                const d = new Date(data);
                const dia = String(d.getDate()).padStart(2, "0");
                const mes = String(d.getMonth() + 1).padStart(2, "0");
                const ano = d.getFullYear();
                return `${dia}/${mes}/${ano}`;
            }

            // Cria linha com todas as funcionalidades
            function criarLinha(numeroDia, data, periodoMin, periodoMax) {
                const tr = document.createElement("tr");

                // Cria a c√©lula da frequ√™ncia com <p>
                const tdFreq = document.createElement("td");
                tdFreq.style.textAlign = "center";
                const p = document.createElement("p");
                p.textContent = formatarDataBR(data);
                p.style.cursor = "pointer";
                p.style.margin = "0";
                tdFreq.appendChild(p);

                // Evento de clique no <p>
                p.addEventListener("click", function () {
                    const input = document.createElement("input");
                    input.type = "date";
                    input.value = data.toISOString().split("T")[0];
                    input.min = periodoMin.toISOString().split("T")[0];
                    input.max = periodoMax.toISOString().split("T")[0];
                    input.style.width = "100%";

                    tdFreq.innerHTML = ""; // limpa o <p>
                    tdFreq.appendChild(input);
                    input.focus();

                    input.addEventListener("blur", function () {
                        const novaData = new Date(input.value + "T00:00:00");
                        p.textContent = formatarDataBR(novaData);
                        tdFreq.innerHTML = "";
                        tdFreq.appendChild(p);
                    });
                });

                // Cria as outras c√©lulas
                function criarCelula(valor = "X", classe = "") {
                    const td = document.createElement("td");
                    td.style.textAlign = "center";
                    td.className = classe;
                    td.textContent = valor;
                    return td;
                }

                const tdCreche = criarCelula("X", "aluno-creche");
                const tdFund = criarCelula("X", "aluno-fundamental");
                const tdEJA = criarCelula("X", "aluno-eja");

                // Card√°pio
                const tdCardapio = document.createElement("td");
                const select = document.createElement("select");
                select.style.width = "100%";
                ["","Arroz, Feij√£o e Frango","Macarronada com Carne Mo√≠da","Sopa de Legumes","Farinha com Peixe Frito","Outra op√ß√£o"].forEach(op => {
                    const option = document.createElement("option");
                    option.value = op;
                    option.textContent = op;
                    select.appendChild(option);
                });
                tdCardapio.appendChild(select);

                // Bot√£o remover
                const tdRemove = document.createElement("td");
                tdRemove.style.textAlign = "center";
                const btnRemove = document.createElement("button");
                btnRemove.className = "remove-row";
                btnRemove.title = "Remover linha";
                btnRemove.style.background = "none";
                btnRemove.style.border = "none";
                btnRemove.style.cursor = "pointer";
                btnRemove.style.fontSize = "18px";
                btnRemove.textContent = "üóëÔ∏è";
                btnRemove.addEventListener("click", () => tr.remove());
                tdRemove.appendChild(btnRemove);

                // Justificativa
                const tdJust = document.createElement("td");
                const inputJust = document.createElement("input");
                inputJust.type = "text";
                inputJust.placeholder = "Justificativa ou observa√ß√£o...";
                inputJust.style.width = "100%";
                tdJust.appendChild(inputJust);

                // Adiciona todas as c√©lulas na linha
                tr.appendChild(document.createElement("td")).textContent = numeroDia;
                tr.appendChild(tdFreq);
                tr.appendChild(tdCreche);
                tr.appendChild(tdFund);
                tr.appendChild(tdEJA);
                tr.appendChild(tdCardapio);
                tr.appendChild(tdRemove);
                tr.appendChild(tdJust);

                tbody.appendChild(tr);
            }

            // Fun√ß√£o para gerar todas as linhas da tabela
            function gerarTabelaCardapio(dataInicial, dataFinal) {
                tbody.innerHTML = "";
                const inicio = new Date(dataInicial + "T00:00:00");
                const fim = new Date(dataFinal + "T00:00:00");
                if (isNaN(inicio) || isNaN(fim)) { alert("Selecione um per√≠odo v√°lido!"); return; }

                let diaAtual = new Date(inicio);
                let contador = 1;

                while (diaAtual <= fim) {
                    criarLinha(contador, new Date(diaAtual), inicio, fim);
                    diaAtual.setDate(diaAtual.getDate() + 1);
                    contador++;
                }
            }

            // Evento do bot√£o Gerar Datas e Card√°pios
            const gerarBtn = document.getElementById("gerar-cardapio");
            if (gerarBtn) {
                gerarBtn.addEventListener("click", function () {
                    const dataInicial = document.getElementById("data-inicial").value;
                    const dataFinal = document.getElementById("data-final").value;
                    gerarTabelaCardapio(dataInicial, dataFinal);
                });
            }
        });






        
        // Lista de dias letivos (voc√™ pode expandir √† vontade)
        const diasLetivos = [
            "10/02/2025","11/02/2025","12/02/2025","13/02/2025","14/02/2025",
            "17/02/2025","18/02/2025","19/02/2025","20/02/2025","21/02/2025",
            "24/02/2025","25/02/2025","26/02/2025","27/02/2025","28/02/2025",
            "03/03/2025","06/03/2025","07/03/2025","10/03/2025","11/03/2025",
            "12/03/2025","13/03/2025","14/03/2025","02/05/2025","03/05/2025",
            "05/05/2025","06/05/2025","07/05/2025","08/05/2025","09/05/2025",
            "12/05/2025","13/05/2025","14/05/2025","15/05/2025","16/05/2025",
            "17/05/2025","19/05/2025","20/05/2025","21/05/2025","22/05/2025",
            "23/05/2025","26/05/2025","27/05/2025","28/05/2025","29/05/2025",
            "30/05/2025","02/06/2025","03/06/2025","05/06/2025","06/06/2025",
            "07/06/2025","09/06/2025","10/06/2025","11/06/2025","12/06/2025",
            "13/06/2025","16/06/2025","17/06/2025","18/06/2025","20/06/2025",
            "23/06/2025","24/06/2025","25/06/2025","26/06/2025","27/06/2025",
            "28/06/2025","30/06/2025","01/07/2025","02/07/2025","03/07/2025",
            "04/07/2025","05/07/2025","07/07/2025","08/07/2025","09/07/2025",
            "10/07/2025","11/07/2025","14/07/2025","15/07/2025","16/07/2025",
            "17/07/2025","18/07/2025","19/07/2025","21/07/2025","22/07/2025",
            "23/07/2025","24/07/2025","25/07/2025","28/07/2025","29/07/2025",
            "30/07/2025","31/07/2025","01/08/2025","02/08/2025","04/08/2025",
            "05/08/2025","06/08/2025","07/08/2025","08/08/2025","11/08/2025",
            "12/08/2025","13/08/2025","14/08/2025","18/08/2025","19/08/2025",
            "20/08/2025","21/08/2025","22/08/2025","23/08/2025","25/08/2025",
            "26/08/2025","27/08/2025","28/08/2025","29/08/2025","01/09/2025",
            "02/09/2025","03/09/2025","04/09/2025","05/09/2025","06/09/2025",
            "08/09/2025","09/09/2025","10/09/2025","11/09/2025","12/09/2025",
            "15/09/2025","16/09/2025","17/09/2025","18/09/2025","19/09/2025",
            "20/09/2025","22/09/2025","23/09/2025","24/09/2025","25/09/2025",
            "26/09/2025","29/09/2025","30/09/2025","01/10/2025","03/10/2025",
            "04/10/2025","06/10/2025","07/10/2025","08/10/2025","09/10/2025",
            "10/10/2025","13/10/2025","14/10/2025","16/10/2025","17/10/2025",
            "18/10/2025","20/10/2025","21/10/2025","22/10/2025","23/10/2025",
            "24/10/2025","27/10/2025","29/10/2025","30/10/2025","31/10/2025",
            "03/11/2025","04/11/2025","05/11/2025","06/11/2025","07/11/2025",
            "08/11/2025","10/11/2025","11/11/2025","12/11/2025","13/11/2025",
            "14/11/2025","17/11/2025","18/11/2025","19/11/2025","21/11/2025",
            "22/11/2025","24/11/2025","25/11/2025","26/11/2025","27/11/2025",
            "28/11/2025","01/12/2025","02/12/2025","03/12/2025","04/12/2025",
            "05/12/2025","06/12/2025","08/12/2025","09/12/2025","10/12/2025",
            "11/12/2025","12/12/2025","15/12/2025","16/12/2025","17/12/2025",
            "18/12/2025","19/12/2025","20/12/2025","22/12/2025","23/12/2025"
        ];

        function generateTable2Rows() {
            const tbody = document.getElementById("table-cardapio-body");
            const dataInicial = document.getElementById("data-inicial").value;
            const dataFinal = document.getElementById("data-final").value;

            if (!dataInicial || !dataFinal) {
                alert("‚ö†Ô∏è Defina o per√≠odo no sidebar antes de gerar as datas!");
                return;
            }

            tbody.innerHTML = "";

            const inicio = new Date(dataInicial + "T00:00:00");
            const fim = new Date(dataFinal + "T00:00:00");

            // converte lista de letivos para formato Date
            const letivosNoPeriodo = diasLetivos
                .map(d => {
                    const [dia, mes, ano] = d.split("/");
                    return new Date(`${ano}-${mes}-${dia}T00:00:00`);
                })
                .filter(d => d >= inicio && d <= fim && d.getDay() !== 0); // exclui domingos

            function formatarDataBR(data) {
                const dia = String(data.getDate()).padStart(2, "0");
                const mes = String(data.getMonth() + 1).padStart(2, "0");
                const ano = data.getFullYear();
                return `${dia}/${mes}/${ano}`;
            }

            letivosNoPeriodo.sort((a, b) => a - b); // ordem crescente

            letivosNoPeriodo.forEach((data, index) => {
                const tr = document.createElement("tr");

                // n¬∫ do dia
                const tdNum = document.createElement("td");
                tdNum.textContent = index + 1;
                tdNum.style.textAlign = "center";

                // coluna data
                const tdData = document.createElement("td");
                const p = document.createElement("p");
                p.textContent = formatarDataBR(data);
                p.style.cursor = "pointer";
                p.style.margin = "0";
                p.style.textAlign = "center";

                // editar data ao clicar
                p.addEventListener("click", function () {
                    const input = document.createElement("input");
                    input.type = "date";
                    input.value = data.toISOString().split("T")[0];
                    input.min = dataInicial;
                    input.max = dataFinal;
                    input.style.width = "100%";
                    input.addEventListener("blur", function () {
                        const nova = new Date(input.value + "T00:00:00");
                        const formato = formatarDataBR(nova);
                        if (!diasLetivos.includes(formato)) {
                            alert("‚ö†Ô∏è Essa data n√£o √© um dia letivo!");
                            tdData.innerHTML = "";
                            tdData.appendChild(p);
                            return;
                        }
                        p.textContent = formato;
                        tdData.innerHTML = "";
                        tdData.appendChild(p);
                    });
                    tdData.innerHTML = "";
                    tdData.appendChild(input);
                    input.focus();
                });

                tdData.appendChild(p);

                // colunas de alunos
                function criarCelulaX() {
                    const td = document.createElement("td");
                    td.textContent = "X";
                    td.style.textAlign = "center";
                    return td;
                }

                const tdCreche = criarCelulaX();
                const tdFund = criarCelulaX();
                const tdEja = criarCelulaX();

                // card√°pio
                const tdCardapio = document.createElement("td");
                const select = document.createElement("select");
                [
                    "",
                    "Arroz, Feij√£o e Frango",
                    "Macarronada com Carne Mo√≠da",
                    "Sopa de Legumes",
                    "Peixe Frito e Acompanhamentos",
                    "Outra op√ß√£o"
                ].forEach(op => {
                    const opt = document.createElement("option");
                    opt.value = op;
                    opt.textContent = op || "Selecione o card√°pio";
                    select.appendChild(opt);
                });
                tdCardapio.appendChild(select);

                // bot√£o remover
                const tdRemove = document.createElement("td");
                const btn = document.createElement("button");
                btn.innerHTML = "üóëÔ∏è";
                btn.style.background = "none";
                btn.style.border = "none";
                btn.style.cursor = "pointer";
                btn.style.fontSize = "18px";
                btn.onclick = () => tr.remove();
                tdRemove.style.textAlign = "center";
                tdRemove.appendChild(btn);

                // justificativa
                const tdJust = document.createElement("td");
                const inputJust = document.createElement("input");
                inputJust.type = "text";
                inputJust.placeholder = "Justificativa ou observa√ß√£o...";
                inputJust.style.width = "100%";
                tdJust.appendChild(inputJust);

                tr.append(tdNum, tdData, tdCreche, tdFund, tdEja, tdCardapio, tdRemove, tdJust);
                tbody.appendChild(tr);
            });

            if (letivosNoPeriodo.length === 0) {
                alert("‚ö†Ô∏è N√£o h√° dias letivos dentro do per√≠odo selecionado.");
            }
        }








        // Fun√ß√£o auxiliar para obter o n√∫mero total de alunos do sidebar
        function getTotalAlunosPermitidos() {
            const sidebarInput = document.getElementById("numAlunosMatriculados");
            let totalSidebar = sidebarInput ? parseInt(sidebarInput.value) || 0 : 0;

            // Se tamb√©m tiver na tabela 1, pode pegar o valor l√°
            const tabela1Input = document.querySelector("#table1 input[name='numAlunos']");
            let totalTabela1 = tabela1Input ? parseInt(tabela1Input.value) || 0 : 0;

            return Math.max(totalSidebar, totalTabela1);
        }

        // Fun√ß√£o para permitir edi√ß√£o e validar soma total de alunos atendidos
        function enableEditableAlunos() {
            const table = document.getElementById("table-cardapio-body");
            const totalPermitido = getTotalAlunosPermitidos();

            table.querySelectorAll(".editable-x").forEach(cell => {
                cell.addEventListener("click", function () {
                    const p = this.querySelector("p");
                    if (!p) return;

                    const currentValue = p.textContent.trim() === "X" ? "" : p.textContent.trim();
                    const input = document.createElement("input");
                    input.type = "number";
                    input.min = 0;
                    input.value = currentValue;
                    input.style.width = "80%";
                    input.style.textAlign = "center";

                    p.replaceWith(input);
                    input.focus();

                    input.addEventListener("blur", () => {
                        const row = input.closest("tr");
                        const inputs = row.querySelectorAll(".editable-x input, .editable-x p");
                        let soma = 0;

                        inputs.forEach(el => {
                            const val = el.tagName === "INPUT" ? parseInt(el.value) || 0 : parseInt(el.textContent) || 0;
                            soma += val;
                        });

                        if (soma > totalPermitido) {
                            alert(`‚ö†Ô∏è O total de alunos atendidos (${soma}) n√£o pode ultrapassar o limite de ${totalPermitido}.`);
                            input.value = "";
                        }

                        const valorFinal = input.value.trim() === "" ? "X" : input.value;
                        const novoP = document.createElement("p");
                        novoP.textContent = valorFinal;
                        novoP.style.textAlign = "center";
                        input.replaceWith(novoP);
                    });
                });
            });
        }

        tr.innerHTML = `
            <td>${i + 1}</td>
            <td><p class="data-dia">${dataFormatada}</p></td>
            <td class="editable-x"><p>X</p></td>
            <td class="editable-x"><p>X</p></td>
            <td class="editable-x"><p>X</p></td>
            <td>
                <select>
                    <option value="">Selecione o card√°pio</option>
                    <option value="Arroz com feij√£o e frango">Arroz com feij√£o e frango</option>
                    <option value="Macarronada">Macarronada</option>
                    <option value="Sopa nutritiva">Sopa nutritiva</option>
                </select>
            </td>
            <td><button class="remove-row"><i class="fas fa-trash"></i></button></td>
            <td><textarea placeholder="Digite aqui..."></textarea></td>
        `;
        enableEditableAlunos();











    </script>


</body>
</html>